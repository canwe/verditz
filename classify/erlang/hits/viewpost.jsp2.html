




<html>
<head>
<title>It isn't Easy to Remove the GIL</title>
<meta name="author" content="Guido van Rossum" />
<link rel="stylesheet" type="text/css" href="../artima.css" />
<link rel="shortcut icon" href="../favicon.ico" />
</head>
<body><table width="100%" cellspacing="0">
<tr>
<td align="left" valign="bottom">
<a href="../index.jsp"><img src="../images/a7.gif" alt="The Artima Developer Community" border="0" width="550" height="43" /></a>
</td>
</table>
<table width="100%" bgcolor="#333333">
<tr>
<td align="center">
<div class="ml">
<a href="../articles" class="hl">Articles</a>&nbsp;|
<a href="../news/index.jsp" class="hl">News</a>&nbsp;|
<a href="../weblogs/index.jsp" class="hl">Weblogs</a>&nbsp;|
<a href="../buzz/index.jsp" class="hl">Buzz</a>&nbsp;|
<a href="../chapters/index.jsp" class="hl">Chapters</a>&nbsp;|
<a href="../forums/index.jsp" class="hl">Forums</a>
</div>
</td>
</tr>
</table>
<table width="100%" bgcolor="#AACCFF">
<tr>
<td align="center">
<div class="sc">
<a href="../weblogs/index.jsp">Artima Weblogs</a>&nbsp;| 

<a href="../weblogs/index.jsp?blogger=guido">Guido van Rossum's Weblog</a>&nbsp;| 

<a href="../forums/flat.jsp?forum=106&thread=214235">Discuss</a>&nbsp;| 
<a href="mailto:?subject=It isn't Easy to Remove the GIL&body= %0AArtima Weblogs %0AIt isn't Easy to Remove the GIL %0Aby Guido van Rossum %0A%0Ahttp://www.artima.com/weblogs/viewpost.jsp?thread=214235">Email</a>&nbsp;| 
<a href="viewpostP.jsp?thread=214235">Print</a>&nbsp;| 
<a href="../weblogs/bloggers.jsp">Bloggers</a>&nbsp;| 
<a class= "sl" href="viewpost.jsp?thread=214122" title="Syncing Motorola RAZR v3xx With Mac iSync 2.4">Previous</a></a>&nbsp;| 
<a class= "sl" href="viewpost.jsp?thread=214325" title="A Response to Bruce Eckel">Next</a></a>
</div>
</td>
</tr>
</table>
<BR>
<div class="vegies">
<div class="tc">
<span class="sts">All Things Pythonic</span><br />
<span class="ts">It isn't Easy to Remove the GIL</span><br />
<span class="as">by Guido van Rossum</span><br />
<span class="pd">September 10, 2007</span><br />
</div>


<blockquote>
<b>Summary</b><br>
A response to a blog post by Juergen Brendel pleading for the removal of the GIL.
</blockquote>

<hr align="left" width="90%">



<table align="right">
<tr>
<td>
<div class="adnotice">
Advertisement
</div>
<center>
<div style="margin-bottom: 1em;" id="rightrectangle"><noscript><a href='http://www.artima.com/zcr/adclick.php?n=a799ecf6' target='_top'><img src='http://www.artima.com/zcr/adview.php?what=zone:2&amp;n=a799ecf6' border='0' alt='' /></a></noscript></div>
</center>
 </td>
</tr>
</table>

<p>
<p>yesterday, Juergen Brendel <a class="reference" href="http://blog.snaplogic.org/?p=94">blogs at length</a> about the disadvantages of the <a class="reference" href="http://docs.python.org/api/threads.html">GIL</a>.  He claims it is an architectural decision I'm making that limits his productivity.</p>
<p>I don't expect that this or any response will stop the requests for the GIL's removal, despite a well-reasoned <a class="reference" href="http://www.python.org/doc/faq/library/#can-t-we-get-rid-of-the-global-interpreter-lock">FAQ entry</a> about the issue.  But I also don't expect it to go away until someone <em>other than me</em> goes through the effort of removing it, and showing that its removal doesn't slow down single-threaded Python code.</p>
<p>This has been tried before, with disappointing results, which is why I'm reluctant to put much effort into it myself.  In 1999 Greg Stein (with Mark Hammond?) produced a fork of Python (1.5 I believe) that removed the GIL, replacing it with fine-grained locks on all mutable data structures.  He also submitted patches that removed many of the reliances on global mutable data structures, which I accepted.  However, after benchmarking, it was shown that even on the platform with the fastest locking primitive (Windows at the time) it slowed down single-threaded execution nearly two-fold, meaning that on two CPUs, you could get just a little more work done without the GIL than on a single CPU with the GIL.  This wasn't enough, and Greg's patch disappeared into oblivion.  (See Greg's <a class="reference" href="http://mail.python.org/pipermail/python-dev/2001-August/017099.html">writeup</a> on the performance.)</p>
<p>I'd welcome it if someone did another experiment along the lines of Greg's patch (which I haven't found online), and I'd welcome a set of patches into Py3k <em>only if</em> the performance for a single-threaded program (and for a multi-threaded but I/O-bound program) <em>does not decrease.</em></p>
<p>I would also be happy if someone volunteered to maintain a GIL-free fork of Python, in case that the single-threaded performance goal can't be met but there is significant value for multi-threaded CPU-bound applications.  We might even end up with all the changes permanently part of the code base, but enabled only on request at compile time.</p>
<p>However, I want to warn that there are many downsides to removing the GIL.  It complicates life for extension modules, who can no longer expect that they are invoked in a &quot;safe zone&quot; protected by the GIL -- as soon as an extension has any global mutable data, will have to be prepared with concurrent calls from multiple threads.  There might also be changes in the Python/C API necessitated by the need to lock certain objects for the duration of a sequence of calls.</p>
<p>While it is my personal opinion, based upon the above considerations, that there isn't enough value in removing the GIL to warrant the effort, I will welcome and support attempts to show that times have changed.  However, there is no point in pleading alone -- Python is open source and I have my hands full dealing with the efforts to produce a quality 3.0 language definition and implementation on time.  I want to point out one more time that the <em>language</em> doesn't require the GIL -- it's only the CPython virtual machine that has historically been unable to shed it.</p>


<h1>Talk Back!</h1>

<p>
Have an opinion?


Readers have already posted

<a href="../forums/flat.jsp?forum=106&thread=214235">47

comments</a>
about this weblog entry. Why not

<a href="../forums/post.jsp?forum=106&thread=214235&reply=true">add yours</a>?


<h1>RSS Feed</h1>

<p>
If you'd like to be notified whenever Guido van Rossum adds a new entry to <a href="index.jsp?blogger=guido">his weblog</a>, subscribe to his <a href="feeds/bloggers/guido.rss">RSS feed</a>.

<h1>About the Blogger</h1>

<P>
<table><tr valign="bottom"><td><img src="../images/guido.jpg" align="right"></td><td>Guido van Rossum is the creator of Python, one of the major
programming languages on and off the web. The Python community refers to him as the BDFL (Benevolent Dictator For Life), a title straight
from a Monty Python skit. He moved from the Netherlands to the USA in
1995, where he met his wife. Until July 2003 they lived in the
northern Virginia suburbs of Washington, DC with their son Orlijn, who
was born in 2001. They then moved to Silicon Valley where Guido now works for Google
(spending 50% of his time on Python!).</td></tr></table><p>

<div class="sp">This weblog entry is Copyright &copy; 2007 Guido van Rossum. All rights reserved.</div>

</div>
<hr width="100%" />
<table width="50%" align="center">
<tr>
<td>
<div class="horizontaltextadbox">
<div class="adheadline">Sponsored Links</div>
<div class="sponlink">
<a href="http://www.artima.com/partners/infragistics?p=najsf&a=tajax">JSF UI Controls: Hierarchical Grid</a>
</div>

<div class="sponlink">
<a href="http://www.artima.com/cgi-bin/sponlink.cgi?account=ADOBE&url=http://ad.doubleclick.net/clk;131736000;19228139;v">Adobe(r) Flex(tm): Learn how Java developers are using Flex software to build apps</a>
</div>

<div class="sponlink">
<a href="http://www.artima.com/cgi-bin/sponlink.cgi?account=ICESOFT&url=http://icefaces.org/main/arti01.jsp">ICEfaces: The Leading Ajax Solution for Enterprise Java Developers</a>
</div>

<div class="sponlink">
<a href="http://www.artima.com/cgi-bin/sponlink.cgi?account=BOCLIENT&url=http://www.businessobjects.com/devxi/989">Crystal Reports - Visit our developer community</a>
</div>

<div class="sponlink">
<a href="http://www.artima.com/partners/mindview/desobjsys.html">Designing Objects &amp; Systems : Seminar on DVD</a>
</div>



</div>
</td>
</tr>
</table>
<hr width="100%" />
<center>
<br />
<script type="text/javascript"><!--
google_ad_client = "pub-3911176865765226";
google_alternate_color = "ffffff";
google_ad_width = 728;
google_ad_height = 15;
google_ad_format = "728x15_0ads_al";
google_ad_channel = "";
google_color_border = "ffffff";
google_color_bg = "FFFFFF";
google_color_link = "003090";
google_color_text = "000000";
google_color_url = "666666";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
<br />
<br />
<!-- SiteSearch Google -->
<form method="get" action="http://www.google.com/custom">
<table border="0" bgcolor="#ffffff">
<tr><td nowrap="nowrap" valign="top" align="left" height="32">
<a href="http://www.google.com/">
<img src="http://www.google.com/logos/Logo_25wht.gif"
border="0" alt="Google"></img></a>
</td>
<td nowrap="nowrap">
<input type="hidden" name="domains" value="Artima.com"></input>
<input type="text" name="q" size="31" maxlength="255" value=""></input>
<input type="submit" name="sa" value="Search"></input>
</td></tr>
<tr>
<td>&nbsp;</td>
<td nowrap="nowrap">
<font size="-1" color="#000000">
<input type="radio" name="sitesearch" value=""></input> Web
<input type="radio" name="sitesearch" value="Artima.com" checked="checked"></input>Artima.com
</font>&nbsp;&nbsp;
<input type="hidden" name="client" value="pub-3911176865765226"></input>
<input type="hidden" name="forid" value="1"></input>
<input type="hidden" name="ie" value="ISO-8859-1"></input>
<input type="hidden" name="oe" value="ISO-8859-1"></input>
<input type="hidden" name="cof" value="GALT:#008000;GL:1;DIV:#336699;VLC:663399;AH:center;BGC:FFFFFF;LBGC:FFFFFF;ALC:0000FF;LC:0000FF;T:000000;GFNT:0000FF;GIMP:0000FF;LH:50;LW:150;L:http://www.artima.com/images/artima150.gif;S:http://www.artima.com;FORID:1;"></input>
<input type="hidden" name="hl" value="en"></input>
</td></tr></table>
</form>
<!-- SiteSearch Google -->
</center>
<br />
<div class="sp">
<div style="text-align: center">
<a href="http://www.artima.com/copyright.html">Copyright</a> &copy; 1996-2007 Artima, Inc. All Rights Reserved.</a> - <a href="http://www.artima.com/privacy.html">Privacy Policy</a> - <a href="http://www.artima.com/termsofuse.html">Terms of Use</a> - <a href="http://www.artima.com/advertising.html">Advertise with Us</a>
</div>
</div>
<br />
<script language='JavaScript' type='text/javascript'>
<!--
function initBannerVarForZone(zone) {
         
        if (!document.phpAds_used) document.phpAds_used = ',';
        phpAds_random = new String (Math.random()); 
        phpAds_random = phpAds_random.substring(2,11);
        
        var nextScriptSrc = 'http://www.artima.com/zcr/adjs_modified.php?n=' +
                phpAds_random  + 
                '&amp;what=zone:' + zone + '&amp;target=_top&amp;block=1&amp;blockcampaign=1' +
                '&amp;exclude=' + document.phpAds_used;
                
        document.write("<script language='JavaScript' type='text/javascript' src='");
        document.write(nextScriptSrc);
        document.write("'><\/script>");
        
}

function replaceDiv(divID) {
        document.getElementById(divID).innerHTML = phpadsbanner;
}       
-->
</script>
<script language='JavaScript' type='text/javascript'>
<!--
initBannerVarForZone(2);
-->
</script>

<script language='JavaScript' type="text/javascript">
<!--
replaceDiv('rightrectangle');
-->
</script>
</body>
</html>
